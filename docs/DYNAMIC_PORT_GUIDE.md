# å‹•æ…‹ç«¯å£åˆ†é…ç³»çµ±ä½¿ç”¨æŒ‡å—

ErSlice ç¾åœ¨æ”¯æŒå‹•æ…‹ç«¯å£åˆ†é…ï¼Œè‡ªå‹•è§£æ±ºé–‹ç™¼ç’°å¢ƒä¸­çš„ç«¯å£è¡çªå•é¡Œã€‚

## ğŸš€ å¿«é€Ÿé–‹å§‹

### ä½¿ç”¨å‹•æ…‹ç«¯å£å•Ÿå‹•é–‹ç™¼æœå‹™å™¨ï¼ˆæ¨è–¦ï¼‰

```bash
npm run dev:auto
# æˆ–
npm run tauri:dev:auto
```

é€™å€‹å‘½ä»¤æœƒï¼š
- ğŸ” è‡ªå‹•å°‹æ‰¾å¯ç”¨ç«¯å£ï¼ˆå¾ 28888 é–‹å§‹ï¼‰
- ğŸ”„ å‹•æ…‹æ›´æ–° Tauri é…ç½®  
- ğŸ“ ç”Ÿæˆç«¯å£é…ç½®æ–‡ä»¶
- ğŸ¦€ å•Ÿå‹•å®Œæ•´çš„ Tauri + React é–‹ç™¼ç’°å¢ƒ

### å‚³çµ±å›ºå®šç«¯å£æ¨¡å¼

å¦‚æœä½ éœ€è¦ä½¿ç”¨å›ºå®šç«¯å£ï¼š

```bash
# ä½¿ç”¨é»˜èªç«¯å£ 28888ï¼ˆå¦‚æœå¯ç”¨ï¼‰
npm run dev:local

# æˆ–æŒ‡å®šç‰¹å®šç«¯å£
PORT=3000 npm run dev:port
```

## ğŸ“‹ å¯ç”¨å‘½ä»¤

| å‘½ä»¤ | æè¿° | ç«¯å£è¡Œç‚º |
|------|------|----------|
| `npm run dev:auto` | å‹•æ…‹ç«¯å£ Vite é–‹ç™¼æœå‹™å™¨ | è‡ªå‹•å°‹æ‰¾å¯ç”¨ç«¯å£ |
| `npm run tauri:dev:auto` | å‹•æ…‹ç«¯å£ Tauri é–‹ç™¼ç’°å¢ƒ | è‡ªå‹•å°‹æ‰¾å¯ç”¨ç«¯å£ + Tauri |
| `npm run dev` | æ¨™æº– Vite é–‹ç™¼æœå‹™å™¨ | Vite é»˜èªè¡Œç‚º |
| `npm run dev:local` | å›ºå®šç«¯å£é–‹ç™¼æœå‹™å™¨ | å›ºå®šä½¿ç”¨ 28888 |
| `npm run dev:port` | ç’°å¢ƒè®Šé‡ç«¯å£æœå‹™å™¨ | ä½¿ç”¨ `PORT` ç’°å¢ƒè®Šé‡ |

## ğŸ› ï¸ æŠ€è¡“ç´°ç¯€

### ç«¯å£æª¢æ¸¬é‚è¼¯

ç³»çµ±æŒ‰ä»¥ä¸‹å„ªå…ˆç´šæª¢æ¸¬ç«¯å£ï¼š

1. **ç’°å¢ƒè®Šé‡**: `PORT=3000 npm run dev:auto`
2. **è‡ªå‹•æª¢æ¸¬**: å¾ 28888 é–‹å§‹å°‹æ‰¾å¯ç”¨ç«¯å£
3. **é»˜èªç«¯å£**: 28888

### è‡ªå‹•ç”Ÿæˆçš„é…ç½®

å‹•æ…‹ç«¯å£ç³»çµ±æœƒè‡ªå‹•ç”Ÿæˆ `src/config/dev-server.js`ï¼š

```javascript
export const DEV_SERVER_CONFIG = {
  port: 28889,
  baseUrl: 'http://127.0.0.1:28889',
  timestamp: '2025-08-19T13:44:51.643Z'
}
```

### å‰ç«¯ç«¯å£æª¢æ¸¬

ä½¿ç”¨æä¾›çš„å·¥å…·å‡½æ•¸åœ¨å‰ç«¯ä»£ç¢¼ä¸­æª¢æ¸¬ç•¶å‰ç«¯å£ï¼š

```typescript
import { getDevServerPort, getDevServerBaseUrl } from '@/utils/portDetection'

// ç²å–ç•¶å‰é–‹ç™¼æœå‹™å™¨ç«¯å£
const port = getDevServerPort()
console.log('é–‹ç™¼æœå‹™å™¨ç«¯å£:', port)

// ç²å–å®Œæ•´çš„åŸºç¤ URL
const baseUrl = getDevServerBaseUrl()
console.log('åŸºç¤ URL:', baseUrl)
```

### React Hook ç”¨æ³•

```tsx
import { usePortConfig } from '@/utils/portDetection'

function MyComponent() {
  const { port, baseUrl, isDevelopment } = usePortConfig()
  
  return (
    <div>
      {isDevelopment && (
        <p>é–‹ç™¼æœå‹™å™¨é‹è¡Œåœ¨: {baseUrl}</p>
      )}
    </div>
  )
}
```

## ğŸ”§ é…ç½®é¸é …

### ç’°å¢ƒè®Šé‡

- `PORT`: æŒ‡å®šèµ·å§‹ç«¯å£è™Ÿ
- `NODE_ENV`: ç’°å¢ƒæ¨¡å¼ï¼ˆdevelopment/productionï¼‰

### Vite é…ç½®

`vite.config.ts` å·²é…ç½®æ”¯æŒå‹•æ…‹ç«¯å£ï¼š

```typescript
server: {
  port: process.env.PORT ? parseInt(process.env.PORT) : 28888,
  host: '127.0.0.1',
  strictPort: false // å…è¨±è‡ªå‹•å°‹æ‰¾å¯ç”¨ç«¯å£
}
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

**Q: ç‚ºä»€éº¼ Tauri ç„¡æ³•é€£æ¥åˆ°å‰ç«¯ï¼Ÿ**
A: ç¢ºä¿ä½¿ç”¨ `npm run tauri:dev:auto` è€Œä¸æ˜¯ `npm run tauri:dev`ï¼Œè‡ªå‹•è…³æœ¬æœƒè™•ç†ç«¯å£é…ç½®ã€‚

**Q: å¦‚ä½•æŸ¥çœ‹ç•¶å‰ä½¿ç”¨çš„ç«¯å£ï¼Ÿ**
A: æŸ¥çœ‹æ§åˆ¶å°è¼¸å‡ºæˆ–æª¢æŸ¥è‡ªå‹•ç”Ÿæˆçš„ `src/config/dev-server.js` æ–‡ä»¶ã€‚

**Q: å¯ä»¥å¼·åˆ¶ä½¿ç”¨ç‰¹å®šç«¯å£å—ï¼Ÿ**
A: ä½¿ç”¨ `PORT=<ç«¯å£è™Ÿ> npm run dev:auto` æˆ–ä½¿ç”¨å›ºå®šç«¯å£å‘½ä»¤ã€‚

### æ—¥å¿—è¼¸å‡ºèªªæ˜

```
ğŸ¯ ErSlice å‹•æ…‹ç«¯å£é–‹ç™¼æœå‹™å™¨å•Ÿå‹•ä¸­...
ğŸš€ å•Ÿå‹• Vite é–‹ç™¼æœå‹™å™¨...
âœ… Vite æœå‹™å™¨å·²å•Ÿå‹•ï¼Œç«¯å£: 28889
âœ… å·²æ›´æ–° Tauri é…ç½®: devUrl = http://127.0.0.1:28889
âœ… å·²å‰µå»ºç«¯å£é…ç½®æ–‡ä»¶: src/config/dev-server.js
ğŸ¦€ å•Ÿå‹• Tauri é–‹ç™¼ç’°å¢ƒ...
ğŸ‰ é–‹ç™¼ç’°å¢ƒå·²å•Ÿå‹•
```

## ğŸ”„ å¾å›ºå®šç«¯å£é·ç§»

å¦‚æœä½ ä¹‹å‰ä½¿ç”¨å›ºå®šç«¯å£ï¼Œå»ºè­°ï¼š

1. **æ›´æ–°é–‹ç™¼å‘½ä»¤**: å°‡ `npm run tauri:dev` æ”¹ç‚º `npm run tauri:dev:auto`
2. **æª¢æŸ¥ç¡¬ç·¨ç¢¼ç«¯å£**: æœç´¢ä»£ç¢¼ä¸­çš„ `28888` ä¸¦ä½¿ç”¨å‹•æ…‹æª¢æ¸¬å‡½æ•¸æ›¿æ›
3. **æ›´æ–°æ§‹å»ºè…³æœ¬**: å¦‚æœ‰å¿…è¦ï¼Œæ›´æ–° CI/CD è…³æœ¬ä½¿ç”¨æ–°å‘½ä»¤

## ğŸ’¡ æœ€ä½³å¯¦è¸

1. **ä½¿ç”¨å‹•æ…‹ç«¯å£**: é–‹ç™¼æ™‚å„ªå…ˆä½¿ç”¨ `dev:auto` å‘½ä»¤
2. **ç«¯å£æª¢æ¸¬**: åœ¨å‰ç«¯ä»£ç¢¼ä¸­ä½¿ç”¨æä¾›çš„å·¥å…·å‡½æ•¸è€Œéç¡¬ç·¨ç¢¼
3. **ç’°å¢ƒéš”é›¢**: ä¸åŒé …ç›®ä½¿ç”¨ä¸åŒçš„èµ·å§‹ç«¯å£ç¯„åœ
4. **æ–‡æª”åŒæ­¥**: åœ˜éšŠæˆå“¡éƒ½ä½¿ç”¨ç›¸åŒçš„é–‹ç™¼å‘½ä»¤

## ğŸ“š ç›¸é—œæ–‡ä»¶

- `scripts/dev-server.js` - å‹•æ…‹ç«¯å£åˆ†é…è…³æœ¬
- `src/utils/portDetection.ts` - å‰ç«¯ç«¯å£æª¢æ¸¬å·¥å…·
- `vite.config.ts` - Vite é…ç½®
- `src-tauri/tauri.conf.json` - Tauri é…ç½®ï¼ˆè‡ªå‹•æ›´æ–°ï¼‰
- `src/config/dev-server.js` - è‡ªå‹•ç”Ÿæˆçš„ç«¯å£é…ç½®

## ğŸ¯ ç¸½çµ

å‹•æ…‹ç«¯å£åˆ†é…ç³»çµ±è§£æ±ºäº†å¤šé …ç›®é–‹ç™¼ä¸­çš„ç«¯å£è¡çªå•é¡Œï¼Œæä¾›äº†ï¼š

- âœ… **è‡ªå‹•ç«¯å£æª¢æ¸¬** - ç„¡éœ€æ‰‹å‹•è™•ç†ç«¯å£è¡çª
- âœ… **é…ç½®è‡ªå‹•åŒæ­¥** - Tauri é…ç½®è‡ªå‹•æ›´æ–°
- âœ… **é–‹ç™¼é«”é©—å„ªåŒ–** - ä¸€å€‹å‘½ä»¤å•Ÿå‹•å®Œæ•´ç’°å¢ƒ  
- âœ… **å‘å¾Œå…¼å®¹** - ä¿ç•™åŸæœ‰çš„å›ºå®šç«¯å£é¸é …
- âœ… **å‰ç«¯å·¥å…·æ”¯æŒ** - æä¾›å®Œæ•´çš„ç«¯å£æª¢æ¸¬ API

æ¨è–¦æ‰€æœ‰é–‹ç™¼è€…ä½¿ç”¨ `npm run dev:auto` ä½œç‚ºä¸»è¦çš„é–‹ç™¼å‘½ä»¤ï¼